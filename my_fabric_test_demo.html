<html>
	<head>
	<style>
        canvas {
	        border: 2px solid #ccc;
        }
    </style>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.7.7/fabric.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
	
	<!-- My javascript example puzzle demo -->
	<script type="text/javascript">
        $( document ).ready(function() {
            var canvas = new fabric.Canvas('my_canvas', { selection: false });
			fabric.util.loadImage('https://i.imgur.com/dzoktzg.jpg', function (img) {

				var num_vertical_pieces = 4;
				var num_horizontal_pieces = 4;

				var piece_sizeX = 250;
				var piece_bufferX  = 10;

			    var piece_sizeY = 250;
				var piece_bufferY  = 10;

				var centering_offset_x = 200;
				var centering_offset_y = 1000;
				var i;

				var position_array = [];
		        for(i = 0; i < num_vertical_pieces; i++) {
		        	var j;
		        	for(j = 0; j < num_horizontal_pieces; j++) {
                        position_array.push({ x: i, y: j})
		        	}
		        }
		        

		        var input = position_array;
		       
				for (var i = input.length-1; i >=0; i--) {
			        var randomIndex = Math.floor(Math.random()*(i+1)); 
			        var itemAtIndex = input[randomIndex]; 
			         
			        input[randomIndex] = input[i]; 
			        input[i] = itemAtIndex;
			    }

			    position_array = input;
					
		        var accessor = 0;
		        for(i = 0; i < num_vertical_pieces; i++) {
		        	var j;
		        	for(j = 0; j < num_horizontal_pieces; j++) {
		        		var x = position_array[accessor].x;
		        		var y = position_array[accessor].y;
		        		accessor++;

			            var rect = new fabric.Rect({ 
			              left: (piece_bufferX+piece_sizeY)*(num_horizontal_pieces-i), 
			              top: (piece_bufferY+piece_sizeX)*(num_vertical_pieces-j), 
			              width: piece_sizeX, 
			              height: piece_sizeY, 
			              fill: '#9f9', 
			              originX: 'left', 
			              originY: 'top',
			              hasControls: false
			            });

					    rect.setPatternFill({
					        source: img,
					        repeat: 'repeat',
					        offsetX: x*piece_sizeX + centering_offset_x,
							offsetY: y*piece_sizeY + centering_offset_y
					    });
					    canvas.renderAll();
			            canvas.add(rect);
					}
				}
			});
        	canvas.renderAll();
        });
        </script>
	</head>
	<body>
	<h1> My Pep-pep puzzle!
	<canvas id="my_canvas" width=2000 height=1500></canvas>
	</body>
</html>
